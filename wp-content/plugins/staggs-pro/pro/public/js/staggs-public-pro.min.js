var staggsBaseTextures={},staggsBaseColors={};function staggsSetExtensionValues(e,t,a){if(e.data("metalness")){var s="";a&&(s=e.data("metalness"));for(var o=0;o<t.length;o++)staggsSetMaterialMetalness(t[o],s)}if(e.data("roughness")){var n="";a&&(n=e.data("roughness"));for(var o=0;o<t.length;o++)staggsSetMaterialRoughness(t[o],n)}if(e.data("model-ior")){var r="";a&&(r=e.data("model-ior"));for(var o=0;o<t.length;o++)staggsSetMaterialIor(t[o],r)}if(e.data("model-clearcoat")){var i="";a&&(i=e.data("model-clearcoat"));for(var o=0;o<t.length;o++)staggsSetClearcoat(t[o],i)}if(e.data("model-transmision")){var l="";a&&(l=e.data("model-transmision"));for(var o=0;o<t.length;o++)staggsSetTransmission(t[o],l)}if(e.data("model-thickness")){var d="";a&&(d=e.data("model-thickness"));for(var o=0;o<t.length;o++)staggsSetThickness(t[o],d)}if(e.data("model-attn-distance")){var p="";a&&(p=e.data("model-attn-distance"));for(var o=0;o<t.length;o++)staggsSetAttenuationDistance(t[o],p)}if(e.data("model-attn-color")){var g="";a&&(g=e.data("model-attn-color"));for(var o=0;o<t.length;o++)staggsSetAttenuationColor(t[o],g)}if(e.data("model-sheen")){var u="";a&&(u=e.data("model-sheen"));for(var o=0;o<t.length;o++)staggsSetSheenColor(t[o],u)}if(e.data("model-sheen-roughness")){var c="";a&&(c=e.data("model-sheen-roughness"));for(var o=0;o<t.length;o++)staggsSetSheenRoughness(t[o],c)}if(e.data("model-specular")){var h="";a&&(h=e.data("model-specular"));for(var o=0;o<t.length;o++)staggsSetSpecularFactor(t[o],h)}if(e.data("model-specular-color")){var f="";a&&(f=e.data("model-specular-color"));for(var o=0;o<t.length;o++)staggsSetSpecularColor(t[o],f)}}function staggsGenerateQRCode(e=""){var t=jQuery("#staggs-qr-popup #staggs-qr-code").data("color"),a=jQuery("#staggs-qr-popup #staggs-qr-code").data("background"),s=jQuery("#staggs-qr-code").data("url");""!==e&&(s=e),jQuery("#staggs-qr-popup #staggs-qr-code").html(""),new QRCode(jQuery("#staggs-qr-code").get(0),{correctLevel:QRCode.CorrectLevel.L,text:s,colorLight:t,colorDark:a})}async function staggsSetTexture(e,t,a){if(a)var s=await modelViewer.createTexture(a);else var s=!1;var o=modelViewer.model.getMaterialByName(e);o&&(await o.ensureLoaded(),!s&&e in staggsBaseTextures&&(s=staggsBaseTextures[e]),t.includes("base")||t.includes("metallic")?(t="base"==t?"baseColorTexture":"metallicRoughnessTexture",null!=o&&o.pbrMetallicRoughness[t]&&o.pbrMetallicRoughness[t].setTexture(s)):(t+="Texture",null!=o&&o[t]&&o[t].setTexture(s)))}async function staggsSetMaterialColor(e,t,a=!1){var s=modelViewer.model.getMaterialByName(e);s&&(await s.ensureLoaded(),!e in staggsBaseColors&&(staggsBaseColors[e]=s.pbrMetallicRoughness.baseColorFactor),null!=s&&s.pbrMetallicRoughness.setBaseColorFactor(t),a&&(jQuery(a).parents(".option-group").data("model-attn-color")&&staggsSetAttenuationColor(e,t),jQuery(a).parents(".option-group").data("model-sheen-color")&&staggsSetSheenColor(e,t),jQuery(a).parents(".option-group").data("model-specular-color")&&staggsSetSpecularColor(e,t)))}async function staggsSetMaterialRoughness(e,t){var a=modelViewer.model.getMaterialByName(e);a&&(await a.ensureLoaded(),null!=a&&a.pbrMetallicRoughness.setRoughnessFactor(t))}async function staggsSetMaterialMetalness(e,t){var a=modelViewer.model.getMaterialByName(e);a&&(await a.ensureLoaded(),null!=a&&a.pbrMetallicRoughness.setMetallicFactor(t))}async function staggsSetMaterialIor(e,t){var a=modelViewer.model.getMaterialByName(e);a&&(await a.ensureLoaded(),null!=a&&a.setIor(t))}async function staggsSetClearcoat(e,t){var a=modelViewer.model.getMaterialByName(e);a&&(await a.ensureLoaded(),null!=a&&a.setClearcoatFactor(t))}async function staggsSetSheenColor(e,t){var a=modelViewer.model.getMaterialByName(e);a&&(await a.ensureLoaded(),null!=a&&a.setSheenColorFactor(t))}async function staggsSetSheenRoughness(e,t){var a=modelViewer.model.getMaterialByName(e);a&&(await a.ensureLoaded(),null!=a&&a.setSheenRoughnessFactor(t))}async function staggsSetTransmission(e,t){var a=modelViewer.model.getMaterialByName(e);a&&(await a.ensureLoaded(),null!=a&&a.setTransmissionFactor(t))}async function staggsSetThickness(e,t){var a=modelViewer.model.getMaterialByName(e);a&&(await a.ensureLoaded(),null!=a&&a.setThicknessFactor(t))}async function staggsSetAttenuationDistance(e,t){var a=modelViewer.model.getMaterialByName(e);a&&(await a.ensureLoaded(),null!=a&&a.setAttenuationDistance(t))}async function staggsSetAttenuationColor(e,t){var a=modelViewer.model.getMaterialByName(e);a&&(await a.ensureLoaded(),null!=a&&a.setAttenuationColor(t))}async function staggsSetSpecularFactor(e,t){var a=modelViewer.model.getMaterialByName(e);a&&(await a.ensureLoaded(),null!=a&&a.setSpecularFactor(t))}async function staggsSetSpecularColor(e,t){var a=modelViewer.model.getMaterialByName(e);a&&(await a.ensureLoaded(),null!=a&&a.setSpecularColorFactor(t))}function collectNodes(e){if(e.find(":selected").length){if(e.find(":selected").data("nodes"))for(var t=e.find(":selected").data("nodes").split(/[,][ ]+/),a=0;a<t.length;a++)if(t[a].includes(":hidden")){if(allGroups.length){var s=allGroupNames.indexOf(t[a]);allGroups[s]?allGroups[s].traverse(e=>{e.type&&"Mesh"==e.type&&-1===hiddenNodes.indexOf(e.name)&&hiddenNodes.push(e.name)}):-1===hiddenNodes.indexOf(t[a])&&hiddenNodes.push(t[a])}else -1===hiddenNodes.indexOf(t[a])&&hiddenNodes.push(t[a])}else if(allGroups.length){var s=allGroupNames.indexOf(t[a]);allGroups[s]?allGroups[s].traverse(e=>{e.type&&"Mesh"==e.type&&-1===visibleNodes.indexOf(e.name)&&visibleNodes.push(e.name)}):-1===visibleNodes.indexOf(t[a])&&visibleNodes.push(t[a])}else -1===visibleNodes.indexOf(t[a])&&visibleNodes.push(t[a])}else e.is(":checked")&&e.data("nodes")&&e.parents(".option-group-options").find("input").each(function(e,t){if(jQuery(t).is(":checked")&&jQuery(t).data("nodes"))for(var a=jQuery(t).data("nodes").split(/[,][ ]+/),s=0;s<a.length;s++)if(a[s].includes(":hidden")){if(allGroups.length){var o=allGroupNames.indexOf(a[s]);allGroups[o]?allGroups[o].traverse(e=>{e.type&&"Mesh"==e.type&&-1===hiddenNodes.indexOf(e.name)&&hiddenNodes.push(e.name)}):-1===hiddenNodes.indexOf(a[s])&&hiddenNodes.push(a[s])}else -1===hiddenNodes.indexOf(a[s])&&hiddenNodes.push(a[s])}else if(allGroups.length){var o=allGroupNames.indexOf(a[s]);allGroups[o]?allGroups[o].traverse(e=>{e.type&&"Mesh"==e.type&&-1===visibleNodes.indexOf(e.name)&&visibleNodes.push(e.name)}):-1===visibleNodes.indexOf(a[s])&&visibleNodes.push(a[s])}else -1===visibleNodes.indexOf(a[s])&&visibleNodes.push(a[s])})}function staggsUpdateNodes(){if(visibleNodes=structuredClone(baseNodes),Object.keys(childNodes).forEach((e,t)=>{jQuery(".option-group[data-step="+e+"]").length&&(jQuery(".option-group[data-step="+e+"] select").length?jQuery(".option-group[data-step="+e+"] select").each(function(e,t){collectNodes(jQuery(t))}):jQuery(".option-group[data-step="+e+"] input:checked").length&&jQuery(".option-group[data-step="+e+"] input:checked").each(function(e,t){collectNodes(jQuery(t))}))}),allObjects)for(var e=0;e<allObjects.length;e++)-1===visibleNodes.indexOf(allObjects[e].name)||-1!==hiddenNodes.indexOf(allObjects[e].name+":hidden")?allObjects[e].visible=!1:allObjects[e].visible=!0;modelViewer[sceneSym]&&(modelViewer[sceneSym].isDirty=!0,modelViewer[sceneSym].updateShadow(),modelViewer[sceneSym].queueRender())}function staggsUpdateHotspots(){jQuery(".staggs-product-view model-viewer").find(".hotspot").remove();for(var e=0;e<baseHotspots.length;e++){var t=modelHotspotData.find(t=>t.id==baseHotspots[e]);t&&jQuery(".staggs-product-view model-viewer").append("<button class='hotspot' slot='hotspot-"+t.id+"' data-position='"+t.position+"' data-normal='"+t.normal+"'><div class='hotspot-toggle'>"+plusicon+minusicon+"</div><div class='hotspot-content'>"+t.content+"</div></button>")}for(var a=0;a<visibleHotspots.length;a++){var s=visibleHotspots[a];if(!baseHotspots.includes(s)){var t=modelHotspotData.find(e=>e.id==visibleHotspots[a]);t&&jQuery(".staggs-product-view model-viewer").append("<button class='hotspot' slot='hotspot-"+t.id+"' data-position='"+t.position+"' data-normal='"+t.normal+"'><div class='hotspot-toggle'>"+plusicon+minusicon+"</div><div class='hotspot-content'>"+t.content+"</div></button>")}}}function removeItem(e,t){var a=e.indexOf(t);return a>-1&&e.splice(a,1),e}async function staggsSetMaterialText(e,t){var a=modelViewer.model.getMaterialByName(e);if(a&&(await a.ensureLoaded(),null!=a)){let{baseColorTexture:s}=a.pbrMetallicRoughness;s.setTexture(staggsGetCanvasTexture())}}jQuery(document).ready(function(e){e(document).on("change",".option-group select",function(){var t=e(this).parents(".option-group").data("step");if(e(this).parents(".option-group").data("model-type")){if("material"===e(this).parents(".option-group").data("model-type")){var a=[];if(e(this).parents(".option-group").data("model")&&(a=e(this).parents(".option-group").data("model").split(/[,][ ]+/)),e(this).find(":selected").data("preview-urls"))for(var s=e(this).find(":selected").data("preview-urls").replace("0|",""),o=e(this).parents(".option-group").data("model-material"),n=0;n<a.length;n++)staggsSetTexture(a[n],o,s);else if(e(this).find(":selected").data("color"))for(var r=e(this).find(":selected").data("color"),n=0;n<a.length;n++)staggsSetMaterialColor(a[n],r,e(this))}else if("variant"===e(this).parents(".option-group").data("model-type")){if(e(this).parents(".option-group").data("model")){var i=e(this).parents(".option-group").data("model"),l=e(this).find(":selected").val();l&&(modelViewer[i]="default"===l?null:l)}}else if("node"===e(this).parents(".option-group").data("model-type")&&e(this).find(":selected").data("nodes")){for(var d=0;d<childNodes[t].length;d++)childNodes[t][d].includes(":hidden")?hiddenNodes=removeItem(hiddenNodes,childNodes[t][d]):visibleNodes=removeItem(visibleNodes,childNodes[t][d]);for(var p=e(this).find(":selected").data("nodes").split(/[,][ ]+/),n=0;n<p.length;n++)p[n].includes(":hidden")?-1===hiddenNodes.indexOf(p[n])&&hiddenNodes.push(p[n]):-1===visibleNodes.indexOf(p[n])&&visibleNodes.push(p[n]);staggsUpdateNodes()}if(e(this).parents(".option-group").data("model")){var a=e(this).parents(".option-group").data("model").split(/[,][ ]+/),g=e(this).find(":selected").length;staggsSetExtensionValues(e(this).parents(".option-group"),a,g)}for(var u=0;u<childHotspots[t].length;u++)visibleHotspots=removeItem(visibleHotspots,childHotspots[t][u]);if(e(this).find(":selected").data("hotspots"))for(var c=e(this).find(":selected").data("hotspots").split(/[,][ ]+/),h=0;h<c.length;h++)-1===visibleHotspots.indexOf(c[h])&&visibleHotspots.push(c[h])}staggsUpdateHotspots(),updateViewerCameraSettings(this)}),e(document).on("change",".option-group input",function(){var t=e(this).parents(".option-group").data("step");if(e(this).parents(".option-group").data("model-type")){if("material"===e(this).parents(".option-group").data("model-type")){var a=[];if(e(this).parents(".option-group").data("model")&&(a=e(this).parents(".option-group").data("model").split(/[,][ ]+/)),e(this).data("preview-urls")){var s=e(this).data("preview-urls").replace("0|",""),o=e(this).parents(".option-group").data("model-material");e(this).is(":checked")||(s=e(this).parents(".option-group").find("input:checked").length?e(this).parents(".option-group").find("input:checked").data("preview-urls").replace("0|",""):"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=");for(var n=0;n<a.length;n++)staggsSetTexture(a[n],o,s)}else if(e(this).data("color")){var r=e(this).data("color");e(this).is(":checked")||(r=e(this).parents(".option-group").find("input:checked").length?e(this).parents(".option-group").find("input:checked").data("color"):"");for(var n=0;n<a.length;n++)staggsSetMaterialColor(a[n],r,e(this))}}else if("variant"===e(this).parents(".option-group").data("model-type")){if(e(this).parents(".option-group").data("model")){var i=e(this).parents(".option-group").data("model"),l=e(this).val();e(this).is(":checked")?modelViewer[i]=l:modelViewer[i]=null}}else if("node"===e(this).parents(".option-group").data("model-type")&&e(this).data("nodes")){for(var d=0;d<childNodes[t].length;d++)childNodes[t][d].includes(":hidden")?hiddenNodes=removeItem(hiddenNodes,childNodes[t][d]):visibleNodes=removeItem(visibleNodes,childNodes[t][d]);e(this).parents(".option-group-options").find("input").each(function(t,a){if(e(a).is(":checked")&&e(a).data("nodes"))for(var s=e(a).data("nodes").split(/[,][ ]+/),o=0;o<s.length;o++)s[o].includes(":hidden")?-1===hiddenNodes.indexOf(s[o])&&hiddenNodes.push(s[o]):-1===visibleNodes.indexOf(s[o])&&visibleNodes.push(s[o])}),staggsUpdateNodes()}}if(e(this).parents(".option-group").data("model")){var a=e(this).parents(".option-group").data("model").split(/[,][ ]+/),p=e(this).is(":checked");staggsSetExtensionValues(e(this).parents(".option-group"),a,p)}for(var g=0;g<childHotspots[t].length;g++)visibleHotspots=removeItem(visibleHotspots,childHotspots[t][g]);e(this).data("hotspots")&&e(this).parents(".option-group-options").find("input").each(function(t,a){if(e(a).is(":checked"))for(var s=e(a).data("hotspots").split(/[,][ ]+/),o=0;o<s.length;o++)-1===visibleHotspots.indexOf(s[o])&&visibleHotspots.push(s[o])}),staggsUpdateHotspots(),updateViewerCameraSettings(this)}),e(document).on("modelOptionsGroupRemoved",function(e,t){"node"===t.modelType&&staggsUpdateNodes(),t.model&&(t.channel&&staggsSetTexture(t.model,t.channel,""),t.color&&staggsSetMaterialColor(t.model,"",t.input))}),e(document).on("modelMaterialChanged",function(e,t){t.model&&t.channel&&t.texture&&staggsSetTexture(t.model,t.channel,t.texture)}),e(document).on("modelMaterialColorChanged",function(e,t){t.model&&t.color&&staggsSetMaterialColor(t.model,t.color,t.input)}),e(document).on("click",".staggs-product-view model-viewer .hotspot",function(t){t.preventDefault(),e(this).toggleClass("active")}),e(document).on("generateNewQRCode",function(t,a){a.url&&(e("#staggs-qr-popup").addClass("shown"),e("body").addClass("panel-shown"),staggsGenerateQRCode(a.url))})});var canvasTexture=null;function staggsGetCanvasTexture(){if(canvasTexture)return canvasTexture;var e=(canvasTexture=modelViewer.createCanvasTexture()).sampler;e.setWrapS(33071),e.setWrapT(33071),e.setRotation(1.13);let t=canvasTexture.source.element;t.width=900,t.height=900;let a=t.getContext("2d");return a.font="90px sans-serif",a.fillStyle="#000",a.fillText("LOGO",200,900),canvasTexture.source.update(),canvasTexture}function createCanvasImageTexture(e,t,a){var s=modelViewer.createCanvasTexture();let o=s.source.element,n=o.getContext("2d");o.width=1200,o.height=1200;let r=new Image;return r.onload=function(){n.drawImage(r,0,0,r.width,r.height),s.source.update()},r.src=a,s.source.update(),s}function updateViewerCameraSettings(e){!jQuery(modelViewer).hasClass("init")&&(jQuery(e).parents(".option-group").data("model-target")?(jQuery(modelViewer).attr("camera-target",jQuery(e).parents(".option-group").data("model-target")),jQuery(modelViewer).attr("camera-orbit",jQuery(e).parents(".option-group").data("model-orbit")),jQuery(modelViewer).attr("field-of-view",jQuery(e).parents(".option-group").data("model-view")),jQuery(modelViewer).addClass("view-changed")):jQuery(modelViewer).hasClass("view-changed")&&(jQuery(modelViewer).attr("camera-target",""),jQuery(modelViewer).attr("camera-orbit",""),jQuery(modelViewer).attr("field-of-view",""),jQuery(modelViewer).removeClass("view-changed")),playViewerOptionAnimation(e))}async function playViewerOptionAnimation(e){jQuery(e).data("animation")?(jQuery(modelViewer).attr("animation-name",jQuery(e).data("animation")),await jQuery(modelViewer).get(0).updateComplete,jQuery(modelViewer).get(0).play({repetitions:1})):(jQuery(modelViewer).attr("animation-name",""),jQuery(modelViewer).get(0).pause())}