(function ($) {

	var wishlist_items = [],
		loggedIn = ($('body').hasClass('logged-in')) ? true : false;

	if (loggedIn) {
		if ( $('.staggs-wishlist-table').length ) {
			// User logged in and admin bar
			$.ajax({
				type: 'get',
				url: opt.ajaxUrl,
				data: {
					action: 'staggs_fetch_customer_wishlist'
				},
				success: function (data) {
					if (data.length > 10) {
						wishlist_items = JSON.parse(data);
					}

					if ( $('.staggs-wishlist-table tbody tr').length ) {
						$('.staggs-wishlist-table-empty').addClass('hidden');
					} else {
						$('.staggs-wishlist-table-empty').removeClass('hidden');
					}

					$('.staggs-wishlist-table').removeClass('loading');
				}
			});
		}

		$(document).on('click', '.staggs-wishlist-table .wishlist-remove', function(e) {
			e.preventDefault();
			
			if ( confirm(opt.wishlistDelete) ) {
				var search = $(this).data('index');
				if (search > -1) {
					wishlist_items.splice(search, 1);
				}

				$.ajax({
					type: 'post',
					url: opt.ajaxUrl,
					data: {
						action: 'staggs_save_wishlist_item_for_user',
						wishlist: wishlist_items,
					},
					success: function (data) {
						$('.staggs-wishlist-table tr[data-id="' + search + '"]').remove();

						if ( $('.staggs-wishlist-table tbody tr').length ) {
							$('.staggs-wishlist-table-empty').addClass('hidden');
						} else {
							$('.staggs-wishlist-table-empty').removeClass('hidden');
						}
					}
				});
			}
		});
	}

})(jQuery);
